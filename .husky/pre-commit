
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "Running pre-commit checks..."

# Check if ESLint is installed
if ! command -v npx lint-staged &> /dev/null
then
    echo "ESLint is not installed. Run 'npm install' or 'yarn install' to install dependencies."
    exit 1
fi

# Run ESLint on staged files
echo "Running ESLint..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|jsx|ts|tsx)$')
if [ -n "$STAGED_FILES" ]; then
    echo "$STAGED_FILES" | xargs npx lint-staged --fix
    ESLINT_EXIT="$?"
    if [ "$ESLINT_EXIT" -ne 0 ]; then
        echo "ðŸ›‘ ESLint found errors. Please fix them before committing."
        exit 1
    fi
else
    echo "No relevant files to check with ESLint."
fi

# Try building the application
echo "Building application to check for errors..."
npm run build
BUILD_EXIT="$?"

if [ "$BUILD_EXIT" -ne 0 ]; then
    echo "ðŸ›‘ Build failed. Please fix the errors before committing."
    exit 1
fi

echo "âœ… Pre-commit checks passed!"
exit 0
